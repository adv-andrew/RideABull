<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Available Rides - Ride A Bull</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="nav">
        <a href="rides.html" class="nav-logo">Ride A Bull</a>
        <a href="post_ride.html" class="btn">Post a Ride</a>
    </nav>

    <div class="container">
        <div class="search-container">
            <div class="form-group">
                <select id="fromCity" required>
                    <option value="">Select Departure</option>
                    <option value="University of Florida">University of Florida</option>
                    <option value="Florida State University">Florida State University</option>
                    <option value="University of South Florida">University of South Florida</option>
                    <option value="University of Central Florida">University of Central Florida</option>
                    <option value="Florida International University">Florida International University</option>
                    <option value="Florida Atlantic University">Florida Atlantic University</option>
                    <option value="University of North Florida">University of North Florida</option>
                    <option value="Florida Gulf Coast University">Florida Gulf Coast University</option>
                    <option value="Florida Polytechnic University">Florida Polytechnic University</option>
                    <option value="Florida A&M University">Florida A&M University</option>
                    <option value="Florida Agricultural and Mechanical University">Florida Agricultural and Mechanical University</option>
                    <option value="New College of Florida">New College of Florida</option>
                    <option value="University of West Florida">University of West Florida</option>
                </select>
            </div>
            <div class="form-group">
                <select id="toCity" required>
                    <option value="">Select Destination</option>
                    <option value="University of Florida">University of Florida</option>
                    <option value="Florida State University">Florida State University</option>
                    <option value="University of South Florida">University of South Florida</option>
                    <option value="University of Central Florida">University of Central Florida</option>
                    <option value="Florida International University">Florida International University</option>
                    <option value="Florida Atlantic University">Florida Atlantic University</option>
                    <option value="University of North Florida">University of North Florida</option>
                    <option value="Florida Gulf Coast University">Florida Gulf Coast University</option>
                    <option value="Florida Polytechnic University">Florida Polytechnic University</option>
                    <option value="Florida A&M University">Florida A&M University</option>
                    <option value="Florida Agricultural and Mechanical University">Florida Agricultural and Mechanical University</option>
                    <option value="New College of Florida">New College of Florida</option>
                    <option value="University of West Florida">University of West Florida</option>
                </select>
            </div>
            <button onclick="searchRides()" class="btn search-btn">Search Rides</button>
        </div>

        <div class="filter-container">
            <select>
                <option value="">Date</option>
                <option value="today">Today</option>
                <option value="tomorrow">Tomorrow</option>
                <option value="week">This Week</option>
            </select>
            <select>
                <option value="">Seats Available</option>
                <option value="1">1 Seat</option>
                <option value="2">2 Seats</option>
                <option value="3">3+ Seats</option>
            </select>
            <select>
                <option value="">Price Range</option>
                <option value="low">$0 - $20</option>
                <option value="medium">$21 - $40</option>
                <option value="high">$41+</option>
            </select>
        </div>

        <div class="rides-list" id="ridesList">
            <!-- Rides will be dynamically inserted here -->
        </div>
    </div>

    <script>
        // Fetch and display rides
        async function fetchRides() {
            try {
                const response = await fetch('http://localhost:3000/api/rides');
                const rides = await response.json();
                displayRides(rides);
            } catch (error) {
                console.error('Error fetching rides:', error);
                document.getElementById('ridesList').innerHTML = '<p>Error loading rides. Please try again later.</p>';
            }
        }

        function displayRides(rides) {
            const ridesList = document.getElementById('ridesList');
            ridesList.innerHTML = rides.map(ride => `
                <a href="ride_details.html?id=${ride._id}" style="text-decoration: none; color: inherit;">
                    <div class="card ride-card">
                        <div class="ride-info">
                            <h3>${ride.origin.name} â†’ ${ride.destination.name}</h3>
                            <div class="ride-meta">
                                <span>ðŸ•’ ${formatDate(ride.startTime)}</span>
                                <span>ðŸ’º ${ride.availableSeats} seats left</span>
                                <span>ðŸ’° $${ride.pricePerSeat}/seat</span>
                            </div>
                            ${ride.preferences && ride.preferences.length > 0 ? `<p class="preferences">${ride.preferences.join(', ')}</p>` : ''}
                        </div>
                        <div class="eco-stats">
                            ðŸŒ± Saves ${Math.floor(Math.random() * 20 + 10)} lbs COâ‚‚
                        </div>
                    </div>
                </a>
            `).join('');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            if (date.toDateString() === today.toDateString()) {
                return `Today, ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
            } else if (date.toDateString() === tomorrow.toDateString()) {
                return `Tomorrow, ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
            } else {
                return date.toLocaleDateString() + ', ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }
        }

        function searchRides() {
            const fromCity = document.getElementById('fromCity').value;
            const toCity = document.getElementById('toCity').value;
            
            const rideCards = document.querySelectorAll('.ride-card');
            
            rideCards.forEach(card => {
                const routeText = card.querySelector('h3').textContent;
                const [from, to] = routeText.split('â†’').map(city => city.trim());
                
                const matchesFrom = !fromCity || from === fromCity;
                const matchesTo = !toCity || to === toCity;
                
                const parentLink = card.parentElement;
                if (matchesFrom && matchesTo) {
                    parentLink.style.display = 'block';
                } else {
                    parentLink.style.display = 'none';
                }
            });
        }

        // Prevent selecting the same university for both departure and destination
        document.getElementById('fromCity').addEventListener('change', function() {
            const toSelect = document.getElementById('toCity');
            const selectedValue = this.value;
            
            Array.from(toSelect.options).forEach(option => {
                if (option.value === selectedValue) {
                    option.disabled = true;
                } else {
                    option.disabled = false;
                }
            });
            
            if (toSelect.value === selectedValue) {
                toSelect.value = '';
            }
        });

        document.getElementById('toCity').addEventListener('change', function() {
            const fromSelect = document.getElementById('fromCity');
            const selectedValue = this.value;
            
            Array.from(fromSelect.options).forEach(option => {
                if (option.value === selectedValue) {
                    option.disabled = true;
                } else {
                    option.disabled = false;
                }
            });
            
            if (fromSelect.value === selectedValue) {
                fromSelect.value = '';
            }
        });

        // Load rides when the page loads
        fetchRides();
    </script>
</body>
</html> 